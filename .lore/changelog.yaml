# Delete Architecture Changelog
# Tracks significant architectural changes

versions:
  - version: "lore-v0.4.0@7816112"
    date: "2025-12-03"
    description: "Typed API client with openapi-fetch and React Query"
    changes:
      - type: added
        description: "Typed API client stack for frontend"
        details: |
          Replaced manual fetch wrapper with fully typed solution:
          - openapi-typescript for generating TypeScript types from OpenAPI spec
          - openapi-fetch for type-safe HTTP requests
          - openapi-react-query for React Query hooks with type inference

          New file structure:
          - apps/my/src/lib/api/schema.d.ts (auto-generated types)
          - apps/my/src/lib/api/openapi.json (local OpenAPI spec)
          - apps/my/src/lib/api/client.ts (openapi-fetch client)
          - apps/my/src/lib/api/hooks.ts ($api React Query hooks)
        links:
          - decision:0010:v1
          - container:my:v1
      - type: added
        description: "QueryClientProvider in main.tsx"
        details: "React Query provider wraps app with 1-minute stale time defaults"
        links:
          - container:my:v1
      - type: changed
        description: "Login/Signup components now use $api.useMutation()"
        details: |
          Components use typed mutations with full type safety:
          - Request body typed from OpenAPI spec
          - Response data typed (TokenResponse)
          - Error structure typed for validation errors
        links:
          - container:my:v1
      - type: removed
        description: "Deleted old apps/my/src/lib/api.ts"
        details: "Manual fetch wrapper replaced by typed openapi-fetch client"
        links:
          - container:my:v1

  - version: "lore-v0.3.0@fe21a0d"
    date: "2025-12-03"
    description: "API deployed to Railway with simplified paths"
    changes:
      - type: added
        description: "Railway hosting for API backend"
        details: |
          Deployed FastAPI backend to Railway at api.trydelete.app:
          - Always-on container (no serverless cold starts)
          - Managed PostgreSQL with pgvector extension
          - Railpack builder (Railway's new default, replaces deprecated Nixpacks)
          - Automatic deploys on push to main
        links:
          - decision:0007:v1
          - decision:0008:v1
          - container:api:v1
      - type: changed
        description: "Simplified API paths from /api/v1/* to /v1/*"
        details: |
          Since API lives at api.trydelete.app subdomain, the /api prefix was redundant.
          New paths:
          - /v1/health (was /api/v1/health)
          - /v1/auth/signup (was /api/v1/auth/signup)
          - /v1/auth/login (was /api/v1/auth/login)
        links:
          - decision:0009:v1
          - container:api:v1
      - type: documented
        description: "Architecture Decision Records 0007-0009"
        details: "Documented Railway hosting, Railpack builder, and path simplification decisions"
        links:
          - decision:0007:v1
          - decision:0008:v1
          - decision:0009:v1

  - version: "lore-v0.2.1@3012485"
    date: "2025-12-03"
    description: "FastAPI backend dependency fixes"
    changes:
      - type: fixed
        description: "Python dependency and configuration issues resolved"
        details: |
          Fixed several issues preventing FastAPI backend from running:
          - Removed non-existent README.md reference from pyproject.toml
          - Added Hatch wheel target for proper src/app package discovery
          - Changed pydantic to pydantic[email] for EmailStr support
          - Added sqlalchemy[asyncio] and greenlet for async support
          - Replaced passlib with direct bcrypt (passlib incompatible with bcrypt 4.x)
          - Fixed alembic env.py to use create_async_engine with settings.database_url
        links:
          - decision:0006:v1
          - container:api:v1
      - type: documented
        description: "Local development gotchas for API backend"
        details: |
          Added documentation for common local dev issues:
          - Port 5432 conflict with local PostgreSQL (Homebrew)
          - bcrypt vs passlib decision rationale
          - Pydantic email extras requirement

  - version: "lore-v0.2.0@b0d89d6"
    date: "2025-12-03"
    description: "FastAPI backend scaffolded"
    changes:
      - type: added
        description: "New container: API (Python FastAPI backend)"
        details: |
          Scaffolded complete FastAPI backend with:
          - Async SQLAlchemy with asyncpg driver
          - JWT-based auth (access + refresh tokens)
          - PostgreSQL 16 with pgvector extension
          - User model with UUID, email, password
          - Auth endpoints (signup, login, refresh)
          - Health check endpoint
          - Alembic migrations
          - Docker Compose for local development
        links:
          - container:api:v1
          - decision:0004:v1
          - entity:user:v1
      - type: added
        description: "Docker Compose configuration for PostgreSQL with pgvector"
        details: "PostgreSQL 16 with pgvector extension for future AI-powered matching"
      - type: updated
        description: "User entity now has implementation code references"
        details: "Previously planned, now has SQLAlchemy model and Pydantic schemas"
        links:
          - entity:user:v1

  - version: "lore-v0.1.0@6e458fd"
    date: "2025-12-03"
    description: "Initial Lorekeeper bootstrap"
    changes:
      - type: added
        description: "Initial .lore/ knowledge store created"
        details: "Bootstrapped architecture documentation for existing codebase"
      - type: documented
        description: "System context (C4 Level 1)"
        links:
          - context:system:v1
      - type: documented
        description: "Container documentation for landing, my, and shared packages"
        links:
          - container:landing:v1
          - container:my:v1
          - container:shared:v1
      - type: documented
        description: "Architecture Decision Records (ADRs 0001-0005)"
        links:
          - decision:0001:v1
          - decision:0002:v1
          - decision:0003:v1
          - decision:0004:v1
          - decision:0005:v1
      - type: documented
        description: "Domain glossary with 14 terms"

# Historical changes inferred from git history
historical:
  - date: "2024-12-03"
    commit: "6bf190a"
    description: "Converted to Turborepo monorepo with pnpm workspaces"
    significance: high
    links:
      - decision:0001:v1

  - date: "2024-12-03"
    commit: "0002929"
    description: "Added Wikipedia-style superscript citations with References sections"
    significance: medium
    links:
      - decision:0005:v1

  - date: "2024-12-03"
    commit: "43e2e64"
    description: "Added Delete Learn - relationship education content (Starlight)"
    significance: high
    links:
      - decision:0002:v1
      - container:landing:v1

  - date: "2024-12-03"
    commit: "4e20c7f"
    description: "Force dark mode via Starlight component overrides"
    significance: low

  - date: "2024-12-03"
    commit: "a474dce"
    description: "Unified landing page and Learn into single Astro build"
    significance: medium

  - date: "2024-12-03"
    commit: "363b043"
    description: "Initial landing page"
    significance: high
