# Delete Architecture Changelog
# Tracks significant architectural changes

versions:
  - version: "lore-v0.5.0@471238b"
    date: "2025-12-04"
    description: "Comprehensive matching system with trait-based compatibility"
    changes:
      - type: added
        description: "Trait-based compatibility scoring system"
        details: |
          6-question behavioral quiz derives personality trait scores (1-5 scale):
          - introvert_extrovert: Social energy preference
          - planner_spontaneous: Planning vs spontaneity
          - conflict_talk_space: Conflict handling style
          - together_alone_time: Togetherness needs
          - slow_quick_decisions: Decision making speed
          - routine_novelty: Lifestyle preference

          Compatibility calculated as inverse of trait differences (0-100 score).
          "Why you might click" highlights generated for aligned traits.
        links:
          - decision:0011:v1
          - entity:user-trait-score:v1
          - component:api.compatibility:v1

      - type: added
        description: "30-day pass cooldown system"
        details: |
          Passes are temporary (30 days) instead of permanent.
          Addresses "regret churn" - users deleting accounts to see rejected profiles.
          Bidirectional pass checking prevents futile likes.
        links:
          - decision:0012:v1
          - entity:pass:v1

      - type: added
        description: "Rate limiting and abuse prevention"
        details: |
          Multi-layer abuse prevention:
          - 10 likes per day limit
          - First 5 likes require personalized comment
          - Velocity detection (5 likes in <60s = suspicious)
          - Spam message detection (same message 3+ times)
          - Report system with auto-blocking
          - Permanent bidirectional blocks
        links:
          - decision:0013:v1
          - entity:like:v1
          - entity:daily-like-count:v1
          - entity:report:v1
          - entity:block:v1

      - type: added
        description: "Match lifecycle state machine"
        details: |
          5-state match lifecycle:
          - ACTIVE: Both users can message
          - UNMATCHED: One user ended it (records who/why)
          - ARCHIVED: No messages in 7+ days
          - DATING: Both confirmed they're dating (Delete success!)
          - DELETED: Account deletion

          Stale match archival job for automatic cleanup.
        links:
          - decision:0014:v1
          - entity:match:v1

      - type: added
        description: "Discovery queue with multi-factor ranking"
        details: |
          Profile ranking factors:
          - Compatibility score (50% weight)
          - Profile completeness (20% weight)
          - Activity recency (10% weight)
          - New user boost (20 points for first 7 days)

          Diversity rules prevent echo chamber matching.
          Graceful scarcity handling with helpful suggestions.
        links:
          - component:api.discovery:v1

      - type: added
        description: "Profile system with photos, prompts, quiz, badges"
        details: |
          Complete profile model:
          - Photos: 2-6 photos with ordering
          - Prompts: Q&A from curated question list
          - Quiz: 6 behavioral questions
          - Badges: Auto-generated from quiz (strong answers only)

          Profile completion calculation affects discovery ranking.
        links:
          - entity:photo:v1
          - entity:prompt:v1
          - entity:quiz-response:v1
          - entity:badge:v1
          - component:api.profile:v1

      - type: added
        description: "Database migrations for profile and matching tables"
        details: |
          - 0003_add_profile_tables.py: photos, prompts, quiz_responses, badges
          - 0004_add_matching_tables.py: likes, passes, matches, blocks, reports, user_trait_scores, daily_like_counts

      - type: documented
        description: "Architecture Decision Records 0011-0014"
        details: |
          - ADR 0011: Trait-based compatibility scoring
          - ADR 0012: 30-day pass cooldown (not permanent)
          - ADR 0013: Rate limiting and abuse prevention
          - ADR 0014: Match lifecycle states

      - type: documented
        description: "10 new entity definitions"
        details: |
          match, like, pass, block, report, user-trait-score,
          quiz-response, daily-like-count, photo, prompt, badge

      - type: documented
        description: "4 new API component docs"
        details: |
          - component:api.compatibility - Trait derivation and scoring
          - component:api.discovery - Profile ranking and filtering
          - component:api.matching - Likes, passes, matches, safety
          - component:api.profile - Photos, prompts, quiz, badges

      - type: updated
        description: "Glossary expanded with 18 matching system terms"

  - version: "lore-v0.4.0@7816112"
    date: "2025-12-03"
    description: "Typed API client with openapi-fetch and React Query"
    changes:
      - type: added
        description: "Typed API client stack for frontend"
        details: |
          Replaced manual fetch wrapper with fully typed solution:
          - openapi-typescript for generating TypeScript types from OpenAPI spec
          - openapi-fetch for type-safe HTTP requests
          - openapi-react-query for React Query hooks with type inference

          New file structure:
          - apps/my/src/lib/api/schema.d.ts (auto-generated types)
          - apps/my/src/lib/api/openapi.json (local OpenAPI spec)
          - apps/my/src/lib/api/client.ts (openapi-fetch client)
          - apps/my/src/lib/api/hooks.ts ($api React Query hooks)
        links:
          - decision:0010:v1
          - container:my:v1
      - type: added
        description: "QueryClientProvider in main.tsx"
        details: "React Query provider wraps app with 1-minute stale time defaults"
        links:
          - container:my:v1
      - type: changed
        description: "Login/Signup components now use $api.useMutation()"
        details: |
          Components use typed mutations with full type safety:
          - Request body typed from OpenAPI spec
          - Response data typed (TokenResponse)
          - Error structure typed for validation errors
        links:
          - container:my:v1
      - type: removed
        description: "Deleted old apps/my/src/lib/api.ts"
        details: "Manual fetch wrapper replaced by typed openapi-fetch client"
        links:
          - container:my:v1

  - version: "lore-v0.3.0@fe21a0d"
    date: "2025-12-03"
    description: "API deployed to Railway with simplified paths"
    changes:
      - type: added
        description: "Railway hosting for API backend"
        details: |
          Deployed FastAPI backend to Railway at api.trydelete.app:
          - Always-on container (no serverless cold starts)
          - Managed PostgreSQL with pgvector extension
          - Railpack builder (Railway's new default, replaces deprecated Nixpacks)
          - Automatic deploys on push to main
        links:
          - decision:0007:v1
          - decision:0008:v1
          - container:api:v1
      - type: changed
        description: "Simplified API paths from /api/v1/* to /v1/*"
        details: |
          Since API lives at api.trydelete.app subdomain, the /api prefix was redundant.
          New paths:
          - /v1/health (was /api/v1/health)
          - /v1/auth/signup (was /api/v1/auth/signup)
          - /v1/auth/login (was /api/v1/auth/login)
        links:
          - decision:0009:v1
          - container:api:v1
      - type: documented
        description: "Architecture Decision Records 0007-0009"
        details: "Documented Railway hosting, Railpack builder, and path simplification decisions"
        links:
          - decision:0007:v1
          - decision:0008:v1
          - decision:0009:v1

  - version: "lore-v0.2.1@3012485"
    date: "2025-12-03"
    description: "FastAPI backend dependency fixes"
    changes:
      - type: fixed
        description: "Python dependency and configuration issues resolved"
        details: |
          Fixed several issues preventing FastAPI backend from running:
          - Removed non-existent README.md reference from pyproject.toml
          - Added Hatch wheel target for proper src/app package discovery
          - Changed pydantic to pydantic[email] for EmailStr support
          - Added sqlalchemy[asyncio] and greenlet for async support
          - Replaced passlib with direct bcrypt (passlib incompatible with bcrypt 4.x)
          - Fixed alembic env.py to use create_async_engine with settings.database_url
        links:
          - decision:0006:v1
          - container:api:v1
      - type: documented
        description: "Local development gotchas for API backend"
        details: |
          Added documentation for common local dev issues:
          - Port 5432 conflict with local PostgreSQL (Homebrew)
          - bcrypt vs passlib decision rationale
          - Pydantic email extras requirement

  - version: "lore-v0.2.0@b0d89d6"
    date: "2025-12-03"
    description: "FastAPI backend scaffolded"
    changes:
      - type: added
        description: "New container: API (Python FastAPI backend)"
        details: |
          Scaffolded complete FastAPI backend with:
          - Async SQLAlchemy with asyncpg driver
          - JWT-based auth (access + refresh tokens)
          - PostgreSQL 16 with pgvector extension
          - User model with UUID, email, password
          - Auth endpoints (signup, login, refresh)
          - Health check endpoint
          - Alembic migrations
          - Docker Compose for local development
        links:
          - container:api:v1
          - decision:0004:v1
          - entity:user:v1
      - type: added
        description: "Docker Compose configuration for PostgreSQL with pgvector"
        details: "PostgreSQL 16 with pgvector extension for future AI-powered matching"
      - type: updated
        description: "User entity now has implementation code references"
        details: "Previously planned, now has SQLAlchemy model and Pydantic schemas"
        links:
          - entity:user:v1

  - version: "lore-v0.1.0@6e458fd"
    date: "2025-12-03"
    description: "Initial Lorekeeper bootstrap"
    changes:
      - type: added
        description: "Initial .lore/ knowledge store created"
        details: "Bootstrapped architecture documentation for existing codebase"
      - type: documented
        description: "System context (C4 Level 1)"
        links:
          - context:system:v1
      - type: documented
        description: "Container documentation for landing, my, and shared packages"
        links:
          - container:landing:v1
          - container:my:v1
          - container:shared:v1
      - type: documented
        description: "Architecture Decision Records (ADRs 0001-0005)"
        links:
          - decision:0001:v1
          - decision:0002:v1
          - decision:0003:v1
          - decision:0004:v1
          - decision:0005:v1
      - type: documented
        description: "Domain glossary with 14 terms"

# Historical changes inferred from git history
historical:
  - date: "2024-12-03"
    commit: "6bf190a"
    description: "Converted to Turborepo monorepo with pnpm workspaces"
    significance: high
    links:
      - decision:0001:v1

  - date: "2024-12-03"
    commit: "0002929"
    description: "Added Wikipedia-style superscript citations with References sections"
    significance: medium
    links:
      - decision:0005:v1

  - date: "2024-12-03"
    commit: "43e2e64"
    description: "Added Delete Learn - relationship education content (Starlight)"
    significance: high
    links:
      - decision:0002:v1
      - container:landing:v1

  - date: "2024-12-03"
    commit: "4e20c7f"
    description: "Force dark mode via Starlight component overrides"
    significance: low

  - date: "2024-12-03"
    commit: "a474dce"
    description: "Unified landing page and Learn into single Astro build"
    significance: medium

  - date: "2024-12-03"
    commit: "363b043"
    description: "Initial landing page"
    significance: high
