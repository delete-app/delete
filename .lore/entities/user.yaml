# User Entity
# Core fields implemented, profile fields planned

id: "entity:user:v1"
name: "User"
description: "A registered Delete user with profile, preferences, and matching data"
status: partial  # core auth fields implemented, profile fields planned
updated: "2025-12-03"

# Implemented fields (in database)
implemented_fields:
  - name: id
    type: uuid
    primary: true
    description: "Unique user identifier"

  - name: email
    type: string
    description: "User's email address (for auth)"
    constraints:
      - unique
      - required
      - indexed

  - name: hashed_password
    type: string
    description: "Bcrypt-hashed password"
    constraints:
      - required

  - name: name
    type: string
    description: "User's name (optional)"
    constraints:
      - nullable

  - name: is_active
    type: boolean
    description: "Whether account is active (for soft disable)"
    default: true

  - name: created_at
    type: timestamp
    description: "Account creation timestamp"

  - name: updated_at
    type: timestamp
    description: "Last update timestamp"

# Planned fields (not yet in database)
planned_fields:
  # Profile fields
  - name: display_name
    type: string
    description: "Name shown to other users"

  - name: bio
    type: text
    description: "Self-description"

  - name: photos
    type: array
    description: "Profile photos (URLs)"

  # Psychological profile (core to Delete's matching)
  - name: attachment_style
    type: enum
    values: [secure, anxious, avoidant, disorganized, unknown]
    description: "Self-reported or assessed attachment style"

  - name: conflict_style
    type: enum
    values: [fight, flight, freeze, fawn, mixed]
    description: "Primary conflict response pattern"

  - name: emotional_needs
    type: array
    description: "Top emotional needs (from assessment)"

  # Matching data
  - name: embedding
    type: vector
    description: "Profile embedding for similarity search (pgvector)"

  - name: preferences
    type: json
    description: "Matching preferences (age range, distance, etc.)"

# Relationships to other entities (planned)
relations:
  - entity: Match
    type: one-to-many
    description: "User has many matches"

  - entity: Message
    type: one-to-many
    description: "User sends many messages"

  - entity: Assessment
    type: one-to-many
    description: "User completes assessments over time"

code_refs:
  model:
    path: "apps/api/src/app/models/user.py"
    description: "SQLAlchemy ORM model"
  schemas:
    path: "apps/api/src/app/schemas/user.py"
    description: "Pydantic request/response schemas (UserCreate, UserResponse, Token)"
  service:
    path: "apps/api/src/app/services/user.py"
    description: "User CRUD operations and authentication"
  migration:
    path: "apps/api/alembic/versions/001_create_users_table.py"
    description: "Initial users table migration"

notes: |
  The User entity is central to Delete's differentiation:
  - Attachment style, conflict style, and emotional needs are first-class fields (planned)
  - Profile embedding enables AI-powered matching (pgvector ready)
  - Assessment history allows tracking growth over time (planned)

  Current implementation:
  - Core auth fields (email, password, active status)
  - UUID primary key for distributed systems
  - Timestamps for auditing

  When expanding, consider:
  - Privacy: What data is shown to other users vs internal
  - GDPR: Data export and deletion capabilities
  - Verification: Email/phone verification flow

links:
  - decision:0004:v1  # PostgreSQL + pgvector
  - container:api:v1
